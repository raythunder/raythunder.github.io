<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Leaflet 笔记 | Raythunder</title>
    <meta name="description" content="An open-source JavaScript library for mobile-friendly interactive maps。所有示例，使用版本为Leaflet 1.2.0">
    <script src="/dat.gui.min.js"></script>
  <script src="/rain.js"></script>
    
    <link rel="preload" href="/assets/css/styles.76be4d86.css" as="style"><link rel="preload" href="/assets/js/app.76be4d86.js" as="script"><link rel="preload" href="/assets/js/8.58d9d8ee.js" as="script"><link rel="prefetch" href="/assets/js/3.b463b416.js"><link rel="prefetch" href="/assets/css/1.styles.8e28fcea.css"><link rel="prefetch" href="/assets/js/1.8e28fcea.js"><link rel="prefetch" href="/assets/css/2.styles.a35f4184.css"><link rel="prefetch" href="/assets/js/2.a35f4184.js"><link rel="prefetch" href="/assets/css/3.styles.b463b416.css"><link rel="prefetch" href="/assets/css/4.styles.cc43d7cd.css"><link rel="prefetch" href="/assets/js/4.cc43d7cd.js"><link rel="prefetch" href="/assets/css/5.styles.2e20b51d.css"><link rel="prefetch" href="/assets/js/5.2e20b51d.js"><link rel="prefetch" href="/assets/js/6.2a979150.js"><link rel="prefetch" href="/assets/js/7.52a00b3f.js"><link rel="prefetch" href="/assets/js/9.b892122c.js">
    <link rel="stylesheet" href="/assets/css/styles.76be4d86.css"><link rel="stylesheet" href="/assets/css/1.styles.8e28fcea.css"><link rel="stylesheet" href="/assets/css/2.styles.a35f4184.css"><link rel="stylesheet" href="/assets/css/3.styles.b463b416.css"><link rel="stylesheet" href="/assets/css/4.styles.cc43d7cd.css"><link rel="stylesheet" href="/assets/css/5.styles.2e20b51d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="page-main"><div class="component-nav-menu"><div class="placeholder"></div> <div class="search-wrapper"><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-7658" class="el-autocomplete"><div class="el-input el-input--prefix"><!----><input type="text" autocomplete="off" valueKey="title" placeholder="请输入内容" fetchSuggestions="function () { [native code] }" triggerOnFocus="true" debounce="300" placement="bottom-start" popperAppendToBody="true" background-color="#eee" value="" class="el-input__inner"><span class="el-input__prefix"><i class="el-input__icon el-icon-search"></i></span><!----><!----></div><div role="region" class="el-autocomplete-suggestion el-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div> <ul role="menubar" class="el-menu--horizontal el-menu" style="background-color:;"><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        Home
      </li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:;border-bottom-color:;background-color:;">
        Blog
      </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        Github
      </li></ul></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="https://github.com/raythunder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Leaflet 笔记</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/leaflet.html#初始化" class="sidebar-link">初始化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/leaflet.html#资源引入" class="sidebar-link">资源引入</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#图层加载-demo" class="sidebar-link">图层加载   demo</a></li></ul></li><li><a href="/blog/leaflet.html#添加自定义元素" class="sidebar-link">添加自定义元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/leaflet.html#添加点、线、面、矩形、圆形-demo" class="sidebar-link">添加点、线、面、矩形、圆形   demo</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#图层组合（groups-of-layers-）-demo" class="sidebar-link">图层组合（Groups of layers ）   demo</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#功能组合（feature-groups-）" class="sidebar-link">功能组合（Feature groups ）</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#弹出（pop-ups）" class="sidebar-link">弹出（Pop ups）</a></li></ul></li><li><a href="/blog/leaflet.html#移动端适配" class="sidebar-link">移动端适配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/leaflet.html#css" class="sidebar-link">css</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#meta" class="sidebar-link">meta</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#定位-demo" class="sidebar-link">定位 demo</a></li><li class="sidebar-sub-header"><a href="/blog/leaflet.html#事件" class="sidebar-link">事件</a></li></ul></li></ul></div></li></ul> </div> <div class="page-container"><div class="page"> <div class="content"><h1 id="leaflet-笔记"><a href="#leaflet-笔记" aria-hidden="true" class="header-anchor">#</a> Leaflet 笔记</h1> <blockquote><p>an open-source JavaScript library for mobile-friendly interactive maps。所有示例，使用版本为Leaflet 1.2.0</p></blockquote> <h2 id="初始化"><a href="#初始化" aria-hidden="true" class="header-anchor">#</a> 初始化</h2> <h3 id="资源引入"><a href="#资源引入" aria-hidden="true" class="header-anchor">#</a> 资源引入</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>src/css/leaflet.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>src/js/leaflet.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 加载国产瓦片服务 https://github.com/htoooth/Leaflet.ChineseTmsProviders --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>src/js/leaflet.ChineseTmsProviders.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="图层加载-demo"><a href="#图层加载-demo" aria-hidden="true" class="header-anchor">#</a> 图层加载   <a href="https://raythunder.github.io/leafletDemo/index.html" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 高德地图</span>
<span class="token keyword">var</span> normalm <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span>tileLayer<span class="token punctuation">.</span><span class="token function">chinaProvider</span><span class="token punctuation">(</span><span class="token string">'GaoDe.Normal.Map'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    maxZoom<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    minZoom<span class="token punctuation">:</span> <span class="token number">15</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> normal <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">layerGroup</span><span class="token punctuation">(</span><span class="token punctuation">[</span>normalm<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> layer <span class="token operator">=</span> <span class="token punctuation">{</span>
    imageUrl<span class="token punctuation">:</span> <span class="token string">'src/images/map2.png'</span><span class="token punctuation">,</span>
    imageBounds<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token number">28.710463073923</span><span class="token punctuation">,</span> <span class="token number">120.621643066406</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">28.668901074144</span><span class="token punctuation">,</span> <span class="token number">120.590744018555</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 叠加单张图片</span>
<span class="token keyword">var</span> imageLayer <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">imageOverlay</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>imageUrl<span class="token punctuation">,</span> layer<span class="token punctuation">.</span>imageBounds<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    zIndex<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    className<span class="token punctuation">:</span> <span class="token string">' base-map'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// var map = L.map('map').setView([35.10418, -106.62987],10);</span>
<span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">28.6896820740335</span><span class="token punctuation">,</span> <span class="token number">120.6061935424805</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    zoom<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    layers<span class="token punctuation">:</span> <span class="token punctuation">[</span>normal<span class="token punctuation">,</span>imageLayer<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 图层</span>
    zoomControl<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="添加自定义元素"><a href="#添加自定义元素" aria-hidden="true" class="header-anchor">#</a> 添加自定义元素</h2> <h3 id="添加点、线、面、矩形、圆形-demo"><a href="#添加点、线、面、矩形、圆形-demo" aria-hidden="true" class="header-anchor">#</a> 添加点、线、面、矩形、圆形   <a href="https://raythunder.github.io/leafletDemo/addSome.html" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> points <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">[</span><span class="token number">28.688366492227118</span><span class="token punctuation">,</span> <span class="token number">120.61868190765382</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span><span class="token number">28.6949545472659</span><span class="token punctuation">,</span> <span class="token number">120.61331748962404</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span><span class="token number">28.69024883597087</span><span class="token punctuation">,</span> <span class="token number">120.59941291809083</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token keyword">var</span> markOption <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">&quot;MyPoint&quot;</span><span class="token punctuation">,</span>
  alt<span class="token punctuation">:</span> <span class="token string">&quot;The Big I&quot;</span><span class="token punctuation">,</span>
  draggable<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// 标注</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> markOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> markOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> markOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>

<span class="token comment">// 线</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">polyline</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> weight<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 多条线组合  同一个polyline方法，使用嵌套数组</span>
<span class="token keyword">var</span> line1<span class="token operator">=</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.696686195776927</span><span class="token punctuation">,</span><span class="token number">120.59344768524171</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.692545249508495</span><span class="token punctuation">,</span><span class="token number">120.59675216674806</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token keyword">var</span> line2<span class="token operator">=</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.696347397235485</span><span class="token punctuation">,</span><span class="token number">120.59838294982912</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.69299699706187</span><span class="token punctuation">,</span><span class="token number">120.59370517730714</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>line1<span class="token punctuation">,</span>line2<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>color<span class="token punctuation">:</span><span class="token string">'blue'</span><span class="token punctuation">,</span>weight<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>

<span class="token comment">// 面</span>
<span class="token keyword">var</span> points2 <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.683509889086483</span><span class="token punctuation">,</span> <span class="token number">120.60370445251465</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.685392320137506</span><span class="token punctuation">,</span> <span class="token number">120.61087131500246</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.68226746605653</span><span class="token punctuation">,</span> <span class="token number">120.61258792877199</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.678314203814065</span><span class="token punctuation">,</span> <span class="token number">120.60370445251465</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">polygon</span><span class="token punctuation">(</span>points2<span class="token punctuation">,</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> weight<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> fillColor<span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> fillOpacity<span class="token punctuation">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 多图形组合</span>
<span class="token keyword">var</span> shap1<span class="token operator">=</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.700601121587397</span><span class="token punctuation">,</span><span class="token number">120.60447692871095</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.702746739951483</span><span class="token punctuation">,</span><span class="token number">120.60971260070802</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.698794250948982</span><span class="token punctuation">,</span><span class="token number">120.6092405319214</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token keyword">var</span> shap2<span class="token operator">=</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.69913304156993</span><span class="token punctuation">,</span><span class="token number">120.60640811920167</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.70289730800929</span><span class="token punctuation">,</span><span class="token number">120.60851097106935</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.699735333299223</span><span class="token punctuation">,</span><span class="token number">120.61142921447755</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">polygon</span><span class="token punctuation">(</span><span class="token punctuation">[</span>shap1<span class="token punctuation">,</span>shap2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> weight<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> fillColor<span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> fillOpacity<span class="token punctuation">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 矩形</span>
<span class="token keyword">var</span> pos1 <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.703160801589114</span><span class="token punctuation">,</span> <span class="token number">120.6017303466797</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 右上角</span>
  <span class="token punctuation">[</span><span class="token number">28.699885905689943</span><span class="token punctuation">,</span> <span class="token number">120.59361934661867</span><span class="token punctuation">]</span>  <span class="token comment">// 左下角</span>
<span class="token punctuation">]</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">rectangle</span><span class="token punctuation">(</span>pos1<span class="token punctuation">,</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span> weight<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> fillColor<span class="token punctuation">:</span> <span class="token string">&quot;blue&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 圆形</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.703085517776877</span><span class="token punctuation">,</span> <span class="token number">120.61507701873781</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">346.72</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span>color<span class="token punctuation">:</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span>weight<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>fillColor<span class="token punctuation">:</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="图层组合（groups-of-layers-）-demo"><a href="#图层组合（groups-of-layers-）-demo" aria-hidden="true" class="header-anchor">#</a> 图层组合（Groups of layers ）   <a href="https://raythunder.github.io/leafletDemo/layer.html" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>将不同类型的元素组合放在一个图层</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 标注</span>
<span class="token keyword">var</span> marker <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.691189995151863</span><span class="token punctuation">,</span> <span class="token number">120.60589313507081</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;I am Marker1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> marker2 <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.68716177447119</span><span class="token punctuation">,</span> <span class="token number">120.60769557952882</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;I am Marker2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> shapPoint <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.693524033410263</span><span class="token punctuation">,</span> <span class="token number">120.61151504516603</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.688855904856077</span><span class="token punctuation">,</span> <span class="token number">120.60121536254884</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token comment">// 矩形</span>
<span class="token keyword">var</span> shap <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">rectangle</span><span class="token punctuation">(</span>shapPoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;I am a rectangle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 组合图层</span>
<span class="token keyword">var</span> myLayerGroup <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">layerGroup</span><span class="token punctuation">(</span><span class="token punctuation">[</span>marker<span class="token punctuation">,</span> shap<span class="token punctuation">]</span><span class="token punctuation">)</span>
myLayerGroup<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// map.addLayer(myLayerGroup)</span>

<span class="token comment">// 向图层组合上继续添加元素</span>
myLayerGroup<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>marker2<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  myLayerGroup<span class="token punctuation">.</span><span class="token function">removeLayer</span><span class="token punctuation">(</span>marker2<span class="token punctuation">)</span>  <span class="token comment">// 从图层组合中移除元素</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  marker2<span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;我已经不在图层组合里了。删不掉我&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> 
  marker2<span class="token punctuation">.</span><span class="token function">openPopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  map<span class="token punctuation">.</span><span class="token function">removeLayer</span><span class="token punctuation">(</span>myLayerGroup<span class="token punctuation">)</span>   <span class="token comment">// 删除图层组合</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn4'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>myLayerGroup<span class="token punctuation">)</span>  <span class="token comment">// 添加图层组合</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="功能组合（feature-groups-）"><a href="#功能组合（feature-groups-）" aria-hidden="true" class="header-anchor">#</a> 功能组合（Feature groups ）</h3> <p>是LayerGroup的扩展，但多了鼠标事件和共享的弹出框方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> marker3 <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.70436533521879</span><span class="token punctuation">,</span> <span class="token number">120.60267448425293</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;I am Marker3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> shapPoint2 <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">28.704741749134378</span><span class="token punctuation">,</span> <span class="token number">120.61469078063966</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">28.700977549043778</span><span class="token punctuation">,</span> <span class="token number">120.60619354248048</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token comment">// 矩形</span>
<span class="token keyword">var</span> shap2 <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">rectangle</span><span class="token punctuation">(</span>shapPoint2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;I am a rectangle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myfeatureGroup <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">featureGroup</span><span class="token punctuation">(</span><span class="token punctuation">[</span>marker3<span class="token punctuation">,</span> shap2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'purple'</span><span class="token punctuation">,</span> opacity<span class="token punctuation">:</span> <span class="token number">.5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;我们共用同一个弹出 because we are a group&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">openPopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="弹出（pop-ups）"><a href="#弹出（pop-ups）" aria-hidden="true" class="header-anchor">#</a> 弹出（Pop ups）</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 自定义弹出</span>
<span class="token keyword">var</span> mark4 <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.697552009289318</span><span class="token punctuation">,</span> <span class="token number">120.60031414031984</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
mark4<span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;My Marker&lt;/h1&gt;&lt;p&gt;This is information about the marker&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Info 1&lt;/li&gt;&lt;li&gt;Info 2&lt;/li&gt;&lt;li&gt;Info 3&lt;/li&gt;&lt;/ul&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openPopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建popup实例，再分配给对象</span>
<span class="token keyword">var</span> mypopup <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">popup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>keepInView<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>closeButton<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;My Marker2&lt;/h1&gt;&lt;p&gt;This is information about the marker&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Info 1&lt;/li&gt;&lt;li&gt;Info 2&lt;/li&gt;&lt;li&gt;Info 3&lt;/li&gt;&lt;/ul&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> mark5 <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.69435222802519</span><span class="token punctuation">,</span> <span class="token number">120.61666488647462</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span>mypopup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
</code></pre></div><h2 id="移动端适配"><a href="#移动端适配" aria-hidden="true" class="header-anchor">#</a> 移动端适配</h2> <h3 id="css"><a href="#css" aria-hidden="true" class="header-anchor">#</a> css</h3> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">html, body, #map</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="meta"><a href="#meta" aria-hidden="true" class="header-anchor">#</a> meta</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="定位-demo"><a href="#定位-demo" aria-hidden="true" class="header-anchor">#</a> 定位 <a href="https://raythunder.github.io/leafletDemo/locate.html" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>获取定位必须要https协议。PC chrome浏览器位置服务调用  https://www.googleapis.com/  需要翻墙才可获取到位置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>map<span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  watch<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开始使用W3C watchPosition方法连续观察位置变化（而不是检测一次）, 停止观察使用map.stopLocate()</span>
  setView<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 定位后地图是否设置到当前位置</span>
  enableHighAccuracy<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 是否启用高精度</span>
  timeout<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1000</span>  <span class="token comment">// 触发locationerror事件之前等待地理定位响应的毫秒数 </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'locationfound'</span><span class="token punctuation">,</span> foundLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'locationerror'</span><span class="token punctuation">,</span> notFoundLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foundLocation</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">notFoundLocation</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>leaflet获得的位置是WGS-84原始<em>坐标系</em>  。对应到高德地图(GCJ－02坐标系)的位置需要进行转换。下面是一些常用的位置转换函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> PointTransformation <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">PI</span><span class="token punctuation">:</span> <span class="token number">3.14159265358979324</span><span class="token punctuation">,</span>
  x_pi<span class="token punctuation">:</span> <span class="token number">3.14159265358979324</span> <span class="token operator">*</span> <span class="token number">3000.0</span> <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">,</span>
  delta<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Krasovsky 1940</span>
    <span class="token comment">//</span>
    <span class="token comment">// a = 6378245.0, 1/f = 298.3</span>
    <span class="token comment">// b = a * (1 - f)</span>
    <span class="token comment">// ee = (a^2 - b^2) / a^2;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">6378245.0</span><span class="token punctuation">;</span> <span class="token comment">//  a: 卫星椭球坐标投影到平面地图坐标系的投影因子。</span>
    <span class="token keyword">var</span> ee <span class="token operator">=</span> <span class="token number">0.00669342162296594323</span><span class="token punctuation">;</span> <span class="token comment">//  ee: 椭球的偏心率。</span>
    <span class="token keyword">var</span> dLat <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transformLat</span><span class="token punctuation">(</span>lon <span class="token operator">-</span> <span class="token number">105.0</span><span class="token punctuation">,</span> lat <span class="token operator">-</span> <span class="token number">35.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> dLon <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transformLon</span><span class="token punctuation">(</span>lon <span class="token operator">-</span> <span class="token number">105.0</span><span class="token punctuation">,</span> lat <span class="token operator">-</span> <span class="token number">35.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> radLat <span class="token operator">=</span> lat <span class="token operator">/</span> <span class="token number">180.0</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> magic <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>radLat<span class="token punctuation">)</span><span class="token punctuation">,</span>
      magic <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> ee <span class="token operator">*</span> magic <span class="token operator">*</span> magic<span class="token punctuation">;</span>
    <span class="token keyword">var</span> sqrtMagic <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>magic<span class="token punctuation">)</span><span class="token punctuation">,</span>
      dLat <span class="token operator">=</span> dLat <span class="token operator">*</span> <span class="token number">180.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> ee<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>magic <span class="token operator">*</span> sqrtMagic<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      dLon <span class="token operator">=</span> dLon <span class="token operator">*</span> <span class="token number">180.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>a <span class="token operator">/</span> sqrtMagic <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>radLat<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> dLat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> dLon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">//WGS-84 to GCJ-02</span>
  gcj_encrypt<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>wgsLat<span class="token punctuation">,</span> wgsLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">outOfChina</span><span class="token punctuation">(</span>wgsLat<span class="token punctuation">,</span> wgsLon<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> wgsLat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> wgsLon <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delta</span><span class="token punctuation">(</span>wgsLat<span class="token punctuation">,</span> wgsLon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> wgsLat <span class="token operator">+</span> d<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> wgsLon <span class="token operator">+</span> d<span class="token punctuation">.</span>lon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//GCJ-02 to WGS-84</span>
  gcj_decrypt<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>gcjLat<span class="token punctuation">,</span> gcjLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">outOfChina</span><span class="token punctuation">(</span>gcjLat<span class="token punctuation">,</span> gcjLon<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> gcjLat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> gcjLon <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delta</span><span class="token punctuation">(</span>gcjLat<span class="token punctuation">,</span> gcjLon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> gcjLat <span class="token operator">-</span> d<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> gcjLon <span class="token operator">-</span> d<span class="token punctuation">.</span>lon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//GCJ-02 to WGS-84 exactly</span>
  gcj_decrypt_exact<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>gcjLat<span class="token punctuation">,</span> gcjLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> initDelta <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> threshold <span class="token operator">=</span> <span class="token number">0.000000001</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> dLat <span class="token operator">=</span> initDelta<span class="token punctuation">,</span>
      dLon <span class="token operator">=</span> initDelta<span class="token punctuation">;</span>
    <span class="token keyword">var</span> mLat <span class="token operator">=</span> gcjLat <span class="token operator">-</span> dLat<span class="token punctuation">,</span>
      mLon <span class="token operator">=</span> gcjLon <span class="token operator">-</span> dLon<span class="token punctuation">;</span>
    <span class="token keyword">var</span> pLat <span class="token operator">=</span> gcjLat <span class="token operator">+</span> dLat<span class="token punctuation">,</span>
      pLon <span class="token operator">=</span> gcjLon <span class="token operator">+</span> dLon<span class="token punctuation">;</span>
    <span class="token keyword">var</span> wgsLat<span class="token punctuation">,</span>
      wgsLon<span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wgsLat <span class="token operator">=</span> <span class="token punctuation">(</span>mLat <span class="token operator">+</span> pLat<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      wgsLon <span class="token operator">=</span> <span class="token punctuation">(</span>mLon <span class="token operator">+</span> pLon<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">gcj_encrypt</span><span class="token punctuation">(</span>wgsLat<span class="token punctuation">,</span> wgsLon<span class="token punctuation">)</span><span class="token punctuation">,</span>
        dLat <span class="token operator">=</span> tmp<span class="token punctuation">.</span>lat <span class="token operator">-</span> gcjLat<span class="token punctuation">,</span>
        dLon <span class="token operator">=</span> tmp<span class="token punctuation">.</span>lon <span class="token operator">-</span> gcjLon<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>dLat<span class="token punctuation">)</span> <span class="token operator">&lt;</span> threshold <span class="token operator">&amp;&amp;</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>dLon<span class="token punctuation">)</span> <span class="token operator">&lt;</span> threshold<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>dLat <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> pLat <span class="token operator">=</span> wgsLat<span class="token punctuation">;</span>
      <span class="token keyword">else</span> mLat <span class="token operator">=</span> wgsLat<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dLon <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> pLon <span class="token operator">=</span> wgsLon<span class="token punctuation">;</span>
      <span class="token keyword">else</span> mLon <span class="token operator">=</span> wgsLon<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">&gt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> wgsLat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> wgsLon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//GCJ-02 to BD-09</span>
  bd_encrypt<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>gcjLat<span class="token punctuation">,</span> gcjLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> gcjLon<span class="token punctuation">,</span>
      y <span class="token operator">=</span> gcjLat<span class="token punctuation">;</span>
    <span class="token keyword">var</span> z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.00002</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x_pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> theta <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.000003</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x_pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bdLon <span class="token operator">=</span> z <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.0065</span><span class="token punctuation">;</span>
    bdLat <span class="token operator">=</span> z <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.006</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> bdLat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> bdLon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//BD-09 to GCJ-02</span>
  bd_decrypt<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>bdLat<span class="token punctuation">,</span> bdLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> bdLon <span class="token operator">-</span> <span class="token number">0.0065</span><span class="token punctuation">,</span>
      y <span class="token operator">=</span> bdLat <span class="token operator">-</span> <span class="token number">0.006</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.00002</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x_pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> theta <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.000003</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x_pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gcjLon <span class="token operator">=</span> z <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gcjLat <span class="token operator">=</span> z <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> gcjLat<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> gcjLon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//WGS-84 to Web mercator</span>
  <span class="token comment">//mercatorLat -&gt; y mercatorLon -&gt; x</span>
  mercator_encrypt<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>wgsLat<span class="token punctuation">,</span> wgsLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> wgsLon <span class="token operator">*</span> <span class="token number">20037508.34</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">+</span> wgsLat<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    y <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token number">20037508.34</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> y<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> x <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
    <span class="token comment">/*
         if ((Math.abs(wgsLon) &gt; 180 || Math.abs(wgsLat) &gt; 90))
         return null;
         var x = 6378137.0 * wgsLon * 0.017453292519943295;
         var a = wgsLat * 0.017453292519943295;
         var y = 3189068.5 * Math.log((1.0 + Math.sin(a)) / (1.0 - Math.sin(a)));
         return {'lat' : y, 'lon' : x};
         //*/</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Web mercator to WGS-84</span>
  <span class="token comment">// mercatorLat -&gt; y mercatorLon -&gt; x</span>
  mercator_decrypt<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>mercatorLat<span class="token punctuation">,</span> mercatorLon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> mercatorLon <span class="token operator">/</span> <span class="token number">20037508.34</span> <span class="token operator">*</span> <span class="token number">180</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> mercatorLat <span class="token operator">/</span> <span class="token number">20037508.34</span> <span class="token operator">*</span> <span class="token number">180</span><span class="token punctuation">;</span>
    y <span class="token operator">=</span>
      <span class="token number">180</span> <span class="token operator">/</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span>
      <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">atan</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> y<span class="token punctuation">,</span> lon<span class="token punctuation">:</span> x <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pt<span class="token punctuation">;</span>
    <span class="token comment">/*
         if (Math.abs(mercatorLon) &lt; 180 &amp;&amp; Math.abs(mercatorLat) &lt; 90)
         return null;
         if ((Math.abs(mercatorLon) &gt; 20037508.3427892) || (Math.abs(mercatorLat) &gt; 20037508.3427892))
         return null;
         var a = mercatorLon / 6378137.0 * 57.295779513082323;
         var x = a - (Math.floor(((a + 180.0) / 360.0)) * 360.0);
         var y = (1.5707963267948966 - (2.0 * Math.atan(Math.exp((-1.0 * mercatorLat) / 6378137.0)))) * 57.295779513082323;
         return {'lat' : y, 'lon' : x};
         //*/</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// two point's distance</span>
  distance<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>latA<span class="token punctuation">,</span> lonA<span class="token punctuation">,</span> latB<span class="token punctuation">,</span> lonB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> earthR <span class="token operator">=</span> <span class="token number">6371000</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span>
      Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>latA <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>latB <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lonA <span class="token operator">-</span> lonB<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>latA <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>latB <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> s <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> s <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> alpha <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">acos</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>
      distance <span class="token operator">=</span> alpha <span class="token operator">*</span> earthR<span class="token punctuation">;</span>
    <span class="token keyword">return</span> distance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  outOfChina<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lon <span class="token operator">&lt;</span> <span class="token number">72.004</span> <span class="token operator">||</span> lon <span class="token operator">&gt;</span> <span class="token number">137.8347</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lat <span class="token operator">&lt;</span> <span class="token number">0.8293</span> <span class="token operator">||</span> lat <span class="token operator">&gt;</span> <span class="token number">55.8271</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  transformLat<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ret <span class="token operator">=</span>
      <span class="token operator">-</span><span class="token number">100.0</span> <span class="token operator">+</span>
      <span class="token number">2.0</span> <span class="token operator">*</span> x <span class="token operator">+</span>
      <span class="token number">3.0</span> <span class="token operator">*</span> y <span class="token operator">+</span>
      <span class="token number">0.2</span> <span class="token operator">*</span> y <span class="token operator">*</span> y <span class="token operator">+</span>
      <span class="token number">0.1</span> <span class="token operator">*</span> x <span class="token operator">*</span> y <span class="token operator">+</span>
      <span class="token number">0.2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret <span class="token operator">+=</span>
      <span class="token punctuation">(</span><span class="token number">20.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">6.0</span> <span class="token operator">*</span> x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token number">20.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      <span class="token number">2.0</span> <span class="token operator">/</span>
      <span class="token number">3.0</span><span class="token punctuation">;</span>
    ret <span class="token operator">+=</span>
      <span class="token punctuation">(</span><span class="token number">20.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">40.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token number">3.0</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      <span class="token number">2.0</span> <span class="token operator">/</span>
      <span class="token number">3.0</span><span class="token punctuation">;</span>
    ret <span class="token operator">+=</span>
      <span class="token punctuation">(</span><span class="token number">160.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token number">12.0</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token number">320</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">30.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      <span class="token number">2.0</span> <span class="token operator">/</span>
      <span class="token number">3.0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  transformLon<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ret <span class="token operator">=</span>
      <span class="token number">300.0</span> <span class="token operator">+</span>
      x <span class="token operator">+</span>
      <span class="token number">2.0</span> <span class="token operator">*</span> y <span class="token operator">+</span>
      <span class="token number">0.1</span> <span class="token operator">*</span> x <span class="token operator">*</span> x <span class="token operator">+</span>
      <span class="token number">0.1</span> <span class="token operator">*</span> x <span class="token operator">*</span> y <span class="token operator">+</span>
      <span class="token number">0.1</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret <span class="token operator">+=</span>
      <span class="token punctuation">(</span><span class="token number">20.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">6.0</span> <span class="token operator">*</span> x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token number">20.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      <span class="token number">2.0</span> <span class="token operator">/</span>
      <span class="token number">3.0</span><span class="token punctuation">;</span>
    ret <span class="token operator">+=</span>
      <span class="token punctuation">(</span><span class="token number">20.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">40.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">3.0</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      <span class="token number">2.0</span> <span class="token operator">/</span>
      <span class="token number">3.0</span><span class="token punctuation">;</span>
    ret <span class="token operator">+=</span>
      <span class="token punctuation">(</span><span class="token number">150.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">12.0</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token number">300.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">30.0</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>
      <span class="token number">2.0</span> <span class="token operator">/</span>
      <span class="token number">3.0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>使用https协议时，marker需要使用自定义的icon。否则无法显示（？）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myicon <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  iconUrl<span class="token punctuation">:</span> <span class="token string">'src/css/images/marker-icon.png'</span><span class="token punctuation">,</span>
  iconSize<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 图片大小</span>
  iconAnchor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">12.5</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 图片尖角的位置偏移，设置大小后，图标默认居中显示</span>
  popupAnchor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">]</span>   <span class="token comment">// 弹出相对于图标的偏移位置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span>latlng<span class="token punctuation">,</span> <span class="token punctuation">{</span> icon<span class="token punctuation">:</span> myicon <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;You are within &quot;</span> <span class="token operator">+</span> radius <span class="token operator">+</span> <span class="token string">&quot; meters from this point&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openPopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="事件"><a href="#事件" aria-hidden="true" class="header-anchor">#</a> 事件</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> myMarker <span class="token operator">=</span> <span class="token constant">L</span>
    <span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>latlng<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      draggable<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

  myMarker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dragend'</span><span class="token punctuation">,</span> whereAmI<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">whereAmI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myMarker<span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token string">&quot;I have been moved to:&quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>myMarker<span class="token punctuation">.</span><span class="token function">getLatLng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> marker1 <span class="token operator">=</span> <span class="token constant">L</span>
  <span class="token punctuation">.</span><span class="token function">marker</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">28.69209</span><span class="token punctuation">,</span> <span class="token number">120.61388</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">bindPopup</span><span class="token punctuation">(</span><span class="token function">createPopup</span><span class="token punctuation">(</span><span class="token string">&quot;Text as aparameter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createPopup</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token constant">L</span>
    <span class="token punctuation">.</span><span class="token function">popup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> keepInView<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> closeButton<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div></div></div></div>
    <script src="/assets/js/8.58d9d8ee.js" defer></script><script src="/assets/js/app.76be4d86.js" defer></script>
  </body>
</html>
